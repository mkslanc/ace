<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ace-diff - Simple Demo #1</title>

    <script src="../demo/kitchen-sink/require.js"></script>

    <style type="text/css">
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
        }

        .ace_diff-container {
            height: 100vh;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: #f1f1f1;
            border-bottom: 1px solid #ddd;
        }

        .toolbar button {
            padding: 5px 10px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
        }

        .toolbar button:hover {
            background: #e6e6e6;
        }

    </style>
</head>
<body>

<div class="toolbar">
    <button id="btn-prev" onclick="goToPrevious()">Previous</button>
    <button id="btn-next" onclick="goToNext()">Next</button>
    <button id="btn-next" onclick="detach()">Detach from editor</button>
    <label>
        <input type="checkbox" id="btn-whitespace" checked onclick="trimWhitespace()"> Ignore Trim Whitespaces
    </label>
    <label>
    <input type="checkbox" id="btn-foldunchanged" onclick="foldUnchanged()"> Collapse unchanged lines
    </label>
</div>

<div class="ace_diff-container"></div>

<script>
    var updateButtonsState = () => {
        document.getElementById("btn-prev").disabled = window.diffView.firstDiffSelected();
        document.getElementById("btn-next").disabled = window.diffView.lastDiffSelected();
    };

    var goToNext = () => {
        window.diffView.gotoNext(1);
        updateButtonsState();
    };

    var goToPrevious = () => {
        window.diffView.gotoNext(-1);
        updateButtonsState();
    };

    var trimWhitespace = () => {
        var checked = document.getElementById("btn-whitespace").checked;
        window.diffView.options.ignoreTrimWhitespace = checked;
        window.diffView.onInput();
    };

    var syncSelections = () => {
        var checked = document.getElementById("btn-syncselections").checked;
        window.diffView.options.syncSelections = checked;
        window.diffView.onInput();
    };

    var foldUnchanged = () => {
        var checked = document.getElementById("btn-foldunchanged").checked;
        window.diffView.options.foldUnchanged = checked;
        window.diffView.onInput();
        if (!checked) {
            window.diffView.diffSession.sessionA.unfold();
            window.diffView.diffSession.sessionB.unfold();
        }
    };

    var detach = () => {
        window.diffView.detach();
    }

    var paths = {
        "ace": "../src",
        "ace-code": "..",
        diff: "."
    };

    require.config({
        paths: paths
    });


    require(["diff/inline_diff_view"], function () {

        var config = require("ace/config");
        config.setLoader(function (moduleName, cb) {
            require([moduleName], function (module) {
                cb(null, module);
            });
        });

        var useLocalStorage = /save=1/.test(location.search);

        var InlineDiffView = require("diff/inline_diff_view").InlineDiffView;
        var EditSession = require("ace/edit_session").EditSession;
        var sessionA, sessionB, diffView, valueA, valueB;

        require("ace/lib/net").get("./diff/0.ts", function (v) {
            valueA = v;
            sessionA = new EditSession(useLocalStorage && localStorage.orig || v);
            require("ace/lib/net").get("./diff/1.ts", function (val) {
                sessionB = new EditSession(useLocalStorage && localStorage.edit || val);
                valueB = val;
                diffView = new InlineDiffView({
                    //sessionA,
                    //sessionB,
                    valueA,
                    valueB,
                    showSideA: true
                }, document.querySelector(".ace_diff-container"));
                window.diffView = diffView;
                diffView.diffSession.sessionB.setMode("ace/mode/typescript");
                diffView.diffSession.sessionA.setMode("ace/mode/typescript");
                diffView.editorB.on("changeSelection", updateButtonsState);
            });
        });

        window.onbeforeunload = function () {
            if (!useLocalStorage) return;
            localStorage.orig = diffView.diffSession.sessionA.getValue();
            localStorage.edit = diffView.editorB.getValue();
        };


    });

</script>


</body>
</html>
